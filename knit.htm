<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Numbered Grid with Save</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
    }

    .controls {
      margin-bottom: 16px;
    }

    label {
      margin-right: 8px;
    }

    input[type="number"] {
      width: 80px;
      margin-right: 12px;
    }

    button {
      padding: 6px 12px;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      margin-top: 16px;
    }

    td {
      min-width: 30px;
      height: 24px;
      text-align: center;
      border: 1px solid #ddd; /* faint border */
      font-size: 12px;
      background-color: white;
      transition: background-color 0.2s ease;
      cursor: pointer;
    }

    /* Header cells */
    .header-cell {
      background-color: #f9f9f9;
      font-weight: 500;
      cursor: default;
    }

    /* Active (coloured) cells */
    .active-cell {
      background-color: red !important;
    }

    /* Bolder borders every 10 rows/columns */
    .bold-top {
      border-top-width: 2px !important;
      border-top-color: #555 !important;
    }

    .bold-right {
      border-right-width: 2px !important;
      border-right-color: #555 !important;
    }
  </style>
</head>
<body>
  <div class="controls">
    <label for="widthInput">Width:</label>
    <input type="number" id="widthInput" min="1" value="20" />

    <label for="heightInput">Height:</label>
    <input type="number" id="heightInput" min="1" value="20" />

    <button type="button" onclick="generateTable()">Generate Table</button>
  </div>

  <div id="tableContainer"></div>

  <script>
    const STORAGE_KEY = 'gridDesignV1';

    function saveDesign(width, height) {
      const table = document.querySelector('#tableContainer table');
      if (!table) return;

      const activeCells = [];
      const dataCells = table.querySelectorAll('td[data-type="data"]');

      dataCells.forEach(td => {
        if (td.classList.contains('active-cell')) {
          activeCells.push({
            r: parseInt(td.dataset.row, 10),
            c: parseInt(td.dataset.col, 10)
          });
        }
      });

      const design = {
        width,
        height,
        activeCells
      };

      localStorage.setItem(STORAGE_KEY, JSON.stringify(design));
    }

    function loadDesign(width, height) {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return;

      let design;
      try {
        design = JSON.parse(saved);
      } catch (e) {
        return;
      }

      if (!design || design.width !== width || design.height !== height) {
        return;
      }

      const table = document.querySelector('#tableContainer table');
      if (!table) return;

      design.activeCells.forEach(pos => {
        const selector =
          `td[data-type="data"][data-row="${pos.r}"][data-col="${pos.c}"]`;
        const cell = table.querySelector(selector);
        if (cell) {
          cell.classList.add('active-cell');
        }
      });
    }

    function generateTable() {
      const width = parseInt(document.getElementById('widthInput').value, 10);
      const height = parseInt(document.getElementById('heightInput').value, 10);

      if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
        alert('Please enter positive integers for width and height.');
        return;
      }

      const tableContainer = document.getElementById('tableContainer');
      tableContainer.innerHTML = '';

      const table = document.createElement('table');

      const totalRows = height + 2; // extra top & bottom
      const totalCols = width + 2;  // extra left & right

      for (let r = 0; r < totalRows; r++) {
        const tr = document.createElement('tr');

        for (let c = 0; c < totalCols; c++) {
          const td = document.createElement('td');
          td.id = `cell-r${r}-c${c}`;

          const isTopHeaderRow = (r === 0);
          const isBottomHeaderRow = (r === totalRows - 1);
          const isLeftHeaderCol = (c === 0);
          const isRightHeaderCol = (c === totalCols - 1);

          const inDataRowRange = (r >= 1 && r <= height);
          const inDataColRange = (c >= 1 && c <= width);

          let rowNumber = null;
          let colNumber = null;

          if (inDataRowRange) {
            rowNumber = height - r + 1;
          }

          if (inDataColRange) {
            colNumber = width - c + 1;
          }

          // Header cells: top/bottom rows showing column numbers
          if ((isTopHeaderRow || isBottomHeaderRow) && inDataColRange) {
            td.textContent = width - c + 1;
            td.classList.add('header-cell');
            td.dataset.type = 'header';
          }

          // Header cells: left/right columns showing row numbers
          if ((isLeftHeaderCol || isRightHeaderCol) && inDataRowRange) {
            td.textContent = height - r + 1;
            td.classList.add('header-cell');
            td.dataset.type = 'header';
          }

          // Corner cells: blank
          if ((isTopHeaderRow || isBottomHeaderRow) &&
              (isLeftHeaderCol || isRightHeaderCol)) {
            td.textContent = '';
            td.classList.add('header-cell');
            td.dataset.type = 'header';
          }

          // Mark data cells and set dataset row/col for saving
          if (inDataRowRange && inDataColRange) {
            td.dataset.type = 'data';
            td.dataset.row = r.toString();
            td.dataset.col = c.toString();

            // Click handler to toggle colour + save design
            td.addEventListener('click', () => {
              td.classList.toggle('active-cell');
              saveDesign(width, height);
            });
          } else {
            // Header cells shouldn't toggle
            td.addEventListener('click', (e) => {
              e.stopPropagation();
            });
          }

          // Bold borders every 10 rows/cols from bottom-right
          if (inDataRowRange && rowNumber !== null && rowNumber % 10 === 0) {
            td.classList.add('bold-top');
          }

          if (inDataColRange && colNumber !== null && colNumber % 10 === 0) {
            td.classList.add('bold-right');
          }

          tr.appendChild(td);
        }

        table.appendChild(tr);
      }

      tableContainer.appendChild(table);

      // After creating the table, try to restore any saved design
      loadDesign(width, height);
    }

    // On page load, restore last width/height and design if available
    window.addEventListener('load', () => {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const design = JSON.parse(saved);
          if (design && design.width && design.height) {
            document.getElementById('widthInput').value = design.width;
            document.getElementById('heightInput').value = design.height;
          }
        } catch (e) {
          // ignore parse errors
        }
      }
      generateTable();
    });
  </script>
</body>
</html>